var init_year_json = {
    country: [{
		"code": "AF",
		"country": "",
		"value": 0,
		"name": "Afghanistan"
	},
	{
		"code": "AL",
		"country": "ALB",
		"value": 0,
		"name": "Albania"
	},
	{
		"code": "DZ",
		"country": "DZA",
		"value": 0,
		"name": "Algeria"
	},
	{
		"code": "AS",
		"country": "",
		"value": 0,
		"name": "American Samoa"
	},
	{
		"code": "AD",
		"country": "",
		"value": 0,
		"name": "Andorra"
	},
	{
		"code": "AO",
		"country": "",
		"value": 0,
		"name": "Angola"
	},
	{
		"code": "AI",
		"country": "",
		"value": 0,
		"name": "Antigua and Barbuda"
	},
	{
		"code": "AR",
		"country": "ARG",
		"value": 0,
		"name": "Argentina"
	},
	{
		"code": "AM",
		"country": "ARM",
		"value": 0,
		"name": "Armenia"
	},
	{
		"code": "AW",
		"country": "",
		"value": 0,
		"name": "Aruba"
	},
	{
		"code": "AU",
		"country": "AUS",
		"value": 0,
		"name": "Australia"
	},
	{
		"code": "AT",
		"country": "AUT",
		"value": 0,
		"name": "Austria"
	},
	{
		"code": "AZ",
		"country": "AZE",
		"value": 0,
		"name": "Azerbaijan"
	},
	{
		"code": "BS",
		"country": "BAH",
		"value": 0,
		"name": "Bahamas, The"
	},
	{
		"code": "BH",
		"country": "BHR",
		"value": 0,
		"name": "Bahrain"
	},
	{
		"code": "BD",
		"country": "BGD",
		"value": 0,
		"name": "Bangladesh"
	},
	{
		"code": "BB",
		"country": "",
		"value": 0,
		"name": "Barbados"
	},
	{
		"code": "BY",
		"country": "BLR",
		"value": 0,
		"name": "Belarus"
	},
	{
		"code": "BE",
		"country": "BEL",
		"value": 0,
		"name": "Belgium"
	},
	{
		"code": "BZ",
		"country": "BLZ",
		"value": 0,
		"name": "Belize"
	},
	{
		"code": "BJ",
		"country": "",
		"value": 0,
		"name": "Benin"
	},
	{
		"code": "BM",
		"country": "BMU",
		"value": 0,
		"name": "Bermuda"
	},
	{
		"code": "BT",
		"country": "",
		"value": 0,
		"name": "Bhutan"
	},
	{
		"code": "BO",
		"country": "",
		"value": 0,
		"name": "Bolivia"
	},
	{
		"code": "BA",
		"country": "",
		"value": 0,
		"name": "Bosnia and Herzegovina"
	},
	{
		"code": "BW",
		"country": "BWA",
		"value": 0,
		"name": "Botswana"
	},
	{
		"code": "BR",
		"country": "BRA",
		"value": 0,
		"name": "Brazil"
	},
	{
		"code": "BN",
		"country": "",
		"value": 0,
		"name": "Brunei Darussalam"
	},
	{
		"code": "BG",
		"country": "BGR",
		"value": 0,
		"name": "Bulgaria"
	},
	{
		"code": "BF",
		"country": "",
		"value": 0,
		"name": "Burkina Faso"
	},
	{
		"code": "BI",
		"country": "",
		"value": 0,
		"name": "Burundi"
	},
	{
		"code": "KH",
		"country": "KHM",
		"value": 0,
		"name": "Cambodia"
	},
	{
		"code": "CM",
		"country": "CMR",
		"value": 0,
		"name": "Cameroon"
	},
	{
		"code": "CA",
		"country": "CAN",
		"value": 0,
		"name": "Canada"
	},
	{
		"code": "CV",
		"country": "",
		"value": 0,
		"name": "Cape Verde"
	},
	{
		"code": "KY",
		"country": "CYM",
		"value": 0,
		"name": "Cayman Islands"
	},
	{
		"code": "CF",
		"country": "",
		"value": 0,
		"name": "Central African Republic"
	},
	{
		"code": "TD",
		"country": "",
		"value": 0,
		"name": "Chad"
	},
	{
		"code": "CL",
		"country": "CHL",
		"value": 0,
		"name": "Chile"
	},
	{
		"code": "CN",
		"country": "CHN",
		"value": 0,
		"name": "China"
	},
	{
		"code": "CO",
		"country": "COL",
		"value": 0,
		"name": "Colombia"
	},
	{
		"code": "KM",
		"country": "",
		"value": 0,
		"name": "Comoros"
	},
	{
		"code": "CD",
		"country": "",
		"value": 0,
		"name": "Congo, Dem. Rep."
	},
	{
		"code": "CG",
		"country": "",
		"value": 0,
		"name": "Congo, Rep."
	},
	{
		"code": "CR",
		"country": "CRI",
		"value": 0,
		"name": "Costa Rica"
	},
	{
		"code": "CI",
		"country": "CIV",
		"value": 0,
		"name": "Cote d'Ivoire"
	},
	{
		"code": "HR",
		"country": "HRV",
		"value": 0,
		"name": "Croatia"
	},
	{
		"code": "CU",
		"country": "",
		"value": 0,
		"name": "Cuba"
	},
	{
		"code": "CW",
		"country": "",
		"value": 0,
		"name": "Curacao"
	},
	{
		"code": "CY",
		"country": "CYP",
		"value": 0,
		"name": "Cyprus"
	},
	{
		"code": "CZ",
		"country": "CZE",
		"value": 0,
		"name": "Czech Republic"
	},
	{
		"code": "DK",
		"country": "DNK",
		"value": 0,
		"name": "Denmark"
	},
	{
		"code": "DJ",
		"country": "",
		"value": 0,
		"name": "Djibouti"
	},
	{
		"code": "DM",
		"country": "DMA",
		"value": 0,
		"name": "Dominica"
	},
	{
		"code": "DO",
		"country": "DOM",
		"value": 0,
		"name": "Dominican Republic"
	},
	{
		"code": "EC",
		"country": "ECU",
		"value": 0,
		"name": "Ecuador"
	},
	{
		"code": "EG",
		"country": "EGY",
		"value": 0,
		"name": "Egypt, Arab Rep."
	},
	{
		"code": "SV",
		"country": "SLV",
		"value": 0,
		"name": "El Salvador"
	},
	{
		"code": "GQ",
		"country": "",
		"value": 0,
		"name": "Equatorial Guinea"
	},
	{
		"code": "ER",
		"country": "",
		"value": 0,
		"name": "Eritrea"
	},
	{
		"code": "EE",
		"country": "EST",
		"value": 0,
		"name": "Estonia"
	},
	{
		"code": "ET",
		"country": "",
		"value": 0,
		"name": "Ethiopia"
	},
	{
		"code": "FO",
		"country": "",
		"value": 0,
		"name": "Faeroe Islands"
	},
	{
		"code": "FJ",
		"country": "",
		"value": 0,
		"name": "Fiji"
	},
	{
		"code": "FI",
		"country": "FIN",
		"value": 0,
		"name": "Finland"
	},
	{
		"code": "FR",
		"country": "FRA",
		"value": 0,
		"name": "France"
	},
	{
		"code": "PF",
		"country": "",
		"value": 0,
		"name": "French Polynesia"
	},
	{
		"code": "GA",
		"country": "",
		"value": 0,
		"name": "Gabon"
	},
	{
		"code": "GM",
		"country": "",
		"value": 0,
		"name": "Gambia, The"
	},
	{
		"code": "GE",
		"country": "GEO",
		"value": 0,
		"name": "Georgia"
	},
	{
		"code": "DE",
		"country": "DEU",
		"value": 0,
		"name": "Germany"
	},
	{
		"code": "GH",
		"country": "GHA",
		"value": 0,
		"name": "Ghana"
	},
	{
		"code": "GR",
		"country": "GRC",
		"value": 0,
		"name": "Greece"
	},
	{
		"code": "GL",
		"country": "",
		"value": 0,
		"name": "Greenland"
	},
	{
		"code": "GD",
		"country": "",
		"value": 0,
		"name": "Grenada"
	},
	{
		"code": "GU",
		"country": "",
		"value": 0,
		"name": "Guam"
	},
	{
		"code": "GT",
		"country": "GTM",
		"value": 0,
		"name": "Guatemala"
	},
	{
		"code": "GN",
		"country": "",
		"value": 0,
		"name": "Guinea"
	},
	{
		"code": "GW",
		"country": "",
		"value": 0,
		"name": "Guinea-Bissau"
	},
	{
		"code": "GY",
		"country": "",
		"value": 0,
		"name": "Guyana"
	},
	{
		"code": "HT",
		"country": "",
		"value": 0,
		"name": "Haiti"
	},
	{
		"code": "HN",
		"country": "HND",
		"value": 0,
		"name": "Honduras"
	},
	{
		"code": "HK",
		"country": "HKG",
		"value": 60,
		"name": "Hong Kong SAR, China"
	},
	{
		"code": "HU",
		"country": "HUN",
		"value": 0,
		"name": "Hungary"
	},
	{
		"code": "IS",
		"country": "ISL",
		"value": 0,
		"name": "Iceland"
	},
	{
		"code": "IN",
		"country": "IND",
		"value": 0,
		"name": "India"
	},
	{
		"code": "ID",
		"country": "IDN",
		"value": 0,
		"name": "Indonesia"
	},
	{
		"code": "IR",
		"country": "IRN",
		"value": 0,
		"name": "Iran, Islamic Rep."
	},
	{
		"code": "IQ",
		"country": "",
		"value": 0,
		"name": "Iraq"
	},
	{
		"code": "IE",
		"country": "IRL",
		"value": 0,
		"name": "Ireland"
	},
	{
		"code": "IM",
		"country": "",
		"value": 0,
		"name": "Isle of Man"
	},
	{
		"code": "IL",
		"country": "ISR",
		"value": 0,
		"name": "Israel"
	},
	{
		"code": "IT",
		"country": "ITA",
		"value": 0,
		"name": "Italy"
	},
	{
		"code": "JM",
		"country": "JAM",
		"value": 0,
		"name": "Jamaica"
	},
	{
		"code": "JP",
		"country": "JPN",
		"value": 0,
		"name": "Japan"
	},
	{
		"code": "JO",
		"country": "JOR",
		"value": 0,
		"name": "Jordan"
	},
	{
		"code": "KZ",
		"country": "KAZ",
		"value": 0,
		"name": "Kazakhstan"
	},
	{
		"code": "KE",
		"country": "KEN",
		"value": 0,
		"name": "Kenya"
	},
	{
		"code": "KI",
		"country": "",
		"value": 0,
		"name": "Kiribati"
	},
	{
		"code": "KP",
		"country": "",
		"value": 0,
		"name": "Korea, Dem. Rep."
	},
	{
		"code": "KR",
		"country": "KOR",
		"value": 0,
		"name": "Korea, Rep."
	},
	{
		"code": "XK",
		"country": "",
		"value": 0,
		"name": "Kosovo"
	},
	{
		"code": "KW",
		"country": "KWT",
		"value": 0,
		"name": "Kuwait"
	},
	{
		"code": "KG",
		"country": "",
		"value": 0,
		"name": "Kyrgyz Republic"
	},
	{
		"code": "LA",
		"country": "LAO",
		"value": 0,
		"name": "Lao PDR"
	},
	{
		"code": "LV",
		"country": "LVA",
		"value": 0,
		"name": "Latvia"
	},
	{
		"code": "LB",
		"country": "LBN",
		"value": 0,
		"name": "Lebanon"
	},
	{
		"code": "LS",
		"country": "",
		"value": 0,
		"name": "Lesotho"
	},
	{
		"code": "LR",
		"country": "",
		"value": 0,
		"name": "Liberia"
	},
	{
		"code": "LY",
		"country": "",
		"value": 0,
		"name": "Libya"
	},
	{
		"code": "LI",
		"country": "LIE",
		"value": 0,
		"name": "Liechtenstein"
	},
	{
		"code": "LT",
		"country": "LTU",
		"value": 0,
		"name": "Lithuania"
	},
	{
		"code": "LU",
		"country": "LUX",
		"value": 0,
		"name": "Luxembourg"
	},
	{
		"code": "MO",
		"country": "",
		"value": 0,
		"name": "Macao SAR, China"
	},
	{
		"code": "MK",
		"country": "MKD",
		"value": 0,
		"name": "Macedonia, FYR"
	},
	{
		"code": "MG",
		"country": "",
		"value": 0,
		"name": "Madagascar"
	},
	{
		"code": "MW",
		"country": "",
		"value": 0,
		"name": "Malawi"
	},
	{
		"code": "MY",
		"country": "MYS",
		"value": 0,
		"name": "Malaysia"
	},
	{
		"code": "MV",
		"country": "",
		"value": 0,
		"name": "Maldives"
	},
	{
		"code": "ML",
		"country": "",
		"value": 0,
		"name": "Mali"
	},
	{
		"code": "MT",
		"country": "MLT",
		"value": 0,
		"name": "Malta"
	},
	{
		"code": "MH",
		"country": "",
		"value": 0,
		"name": "Marshall Islands"
	},
	{
		"code": "MR",
		"country": "",
		"value": 0,
		"name": "Mauritania"
	},
	{
		"code": "MU",
		"country": "MUS",
		"value": 0,
		"name": "Mauritius"
	},
	{
		"code": "YT",
		"country": "",
		"value": 0,
		"name": "Mayotte"
	},
	{
		"code": "MX",
		"country": "MEX",
		"value": 0,
		"name": "Mexico"
	},
	{
		"code": "FM",
		"country": "",
		"value": 0,
		"name": "Micronesia, Fed. Sts."
	},
	{
		"code": "MD",
		"country": "MDA",
		"value": 0,
		"name": "Moldova"
	},
	{
		"code": "MC",
		"country": "",
		"value": 0,
		"name": "Monaco"
	},
	{
		"code": "MN",
		"country": "",
		"value": 0,
		"name": "Mongolia"
	},
	{
		"code": "ME",
		"country": "MNE",
		"value": 0,
		"name": "Montenegro"
	},
	{
		"code": "MA",
		"country": "MAR",
		"value": 0,
		"name": "Morocco"
	},
	{
		"code": "MZ",
		"country": "",
		"value": 0,
		"name": "Mozambique"
	},
	{
		"code": "MM",
		"country": "MMR",
		"value": 0,
		"name": "Myanmar"
	},
	{
		"code": "NA",
		"country": "",
		"value": 0,
		"name": "Namibia"
	},
	{
		"code": "NP",
		"country": "NPL",
		"value": 0,
		"name": "Nepal"
	},
	{
		"code": "NL",
		"country": "NLD",
		"value": 0,
		"name": "Netherlands"
	},
	{
		"code": "NC",
		"country": "",
		"value": 0,
		"name": "New Caledonia"
	},
	{
		"code": "NZ",
		"country": "NZL",
		"value": 0,
		"name": "New Zealand"
	},
	{
		"code": "NI",
		"country": "",
		"value": 0,
		"name": "Nicaragua"
	},
	{
		"code": "NE",
		"country": "",
		"value": 0,
		"name": "Niger"
	},
	{
		"code": "NG",
		"country": "NGA",
		"value": 0,
		"name": "Nigeria"
	},
	{
		"code": "MP",
		"country": "",
		"value": 0,
		"name": "Northern Mariana Islands"
	},
	{
		"code": "NO",
		"country": "NOR",
		"value": 0,
		"name": "Norway"
	},
	{
		"code": "OM",
		"country": "OMN",
		"value": 0,
		"name": "Oman"
	},
	{
		"code": "PK",
		"country": "PAK",
		"value": 0,
		"name": "Pakistan"
	},
	{
		"code": "PW",
		"country": "",
		"value": 0,
		"name": "Palau"
	},
	{
		"code": "PA",
		"country": "PAN",
		"value": 0,
		"name": "Panama"
	},
	{
		"code": "PG",
		"country": "",
		"value": 0,
		"name": "Papua New Guinea"
	},
	{
		"code": "PY",
		"country": "PRY",
		"value": 0,
		"name": "Paraguay"
	},
	{
		"code": "PE",
		"country": "PER",
		"value": 0,
		"name": "Peru"
	},
	{
		"code": "PH",
		"country": "PHL",
		"value": 0,
		"name": "Philippines"
	},
	{
		"code": "PL",
		"country": "POL",
		"value": 0,
		"name": "Poland"
	},
	{
		"code": "PT",
		"country": "PRT",
		"value": 0,
		"name": "Portugal"
	},
	{
		"code": "PR",
		"country": "PRI",
		"value": 0,
		"name": "Puerto Rico"
	},
	{
		"code": "WA",
		"country": "QAT",
		"value": 0,
		"name": "Qatar"
	},
	{
		"code": "RO",
		"country": "ROM",
		"value": 0,
		"name": "Romania"
	},
	{
		"code": "RU",
		"country": "RUS",
		"value": 0,
		"name": "Russian Federation"
	},
	{
		"code": "RW",
		"country": "RWA",
		"value": 0,
		"name": "Rwanda"
	},
	{
		"code": "WS",
		"country": "",
		"value": 0,
		"name": "Samoa"
	},
	{
		"code": "SM",
		"country": "",
		"value": 0,
		"name": "San Marino"
	},
	{
		"code": "ST",
		"country": "",
		"value": 0,
		"name": "Sao Tome and Principe"
	},
	{
		"code": "SA",
		"country": "SAU",
		"value": 0,
		"name": "Saudi Arabia"
	},
	{
		"code": "SN",
		"country": "SEN",
		"value": 0,
		"name": "Senegal"
	},
	{
		"code": "RS",
		"country": "SRB",
		"value": 0,
		"name": "Serbia"
	},
	{
		"code": "SC",
		"country": "SYC",
		"value": 0,
		"name": "Seychelles"
	},
	{
		"code": "SL",
		"country": "",
		"value": 0,
		"name": "Sierra Leone"
	},
	{
		"code": "SG",
		"country": "SGP",
		"value": 0,
		"name": "Singapore"
	},
	{
		"code": "SK",
		"country": "SVK",
		"value": 0,
		"name": "Slovak Republic"
	},
	{
		"code": "SI",
		"country": "SVN",
		"value": 0,
		"name": "Slovenia"
	},
	{
		"code": "SB",
		"country": "",
		"value": 0,
		"name": "Solomon Islands"
	},
	{
		"code": "SO",
		"country": "SOM",
		"value": 0,
		"name": "Somalia"
	},
	{
		"code": "ZA",
		"country": "ZAF",
		"value": 0,
		"name": "South Africa"
	},
	{
		"code": "SS",
		"country": "",
		"value": 0,
		"name": "South Sudan"
	},
	{
		"code": "ES",
		"country": "ESP",
		"value": 0,
		"name": "Spain"
	},
	{
		"code": "LK",
		"country": "LKA",
		"value": 0,
		"name": "Sri Lanka"
	},
	{
		"code": "KN",
		"country": "KNA",
		"value": 0,
		"name": "St. Kitts and Nevis"
	},
	{
		"code": "LC",
		"country": "",
		"value": 0,
		"name": "St. Lucia"
	},
	{
		"code": "MF",
		"country": "MAF",
		"value": 0,
		"name": "St. Martin (French part)"
	},
	{
		"code": "VC",
		"country": "",
		"value": 0,
		"name": "St. Vincent and the Grenadines"
	},
	{
		"code": "SD",
		"country": "",
		"value": 0,
		"name": "Sudan"
	},
	{
		"code": "SR",
		"country": "",
		"value": 0,
		"name": "Suriname"
	},
	{
		"code": "SZ",
		"country": "",
		"value": 0,
		"name": "Swaziland"
	},
	{
		"code": "SE",
		"country": "",
		"value": 0,
		"name": "Sweden"
	},
	{
		"code": "CH",
		"country": "CHE",
		"value": 0,
		"name": "Switzerland"
	},
	{
		"code": "SY",
		"country": "",
		"value": 0,
		"name": "Syrian Arab Republic"
	},
	{
		"code": "TJ",
		"country": "",
		"value": 0,
		"name": "Tajikistan"
	},
	{
		"code": "TZ",
		"country": "TAN",
		"value": 0,
		"name": "Tanzania"
	},
	{
		"code": "TH",
		"country": "THA",
		"value": 0,
		"name": "Thailand"
	},
	{
		"code": "TP",
		"country": "",
		"value": 0,
		"name": "Timor-Leste"
	},
	{
		"code": "TG",
		"country": "TGO",
		"value": 0,
		"name": "Togo"
	},
	{
		"code": "TO",
		"country": "",
		"value": 0,
		"name": "Tonga"
	},
	{
		"code": "TT",
		"country": "TTO",
		"value": 0,
		"name": "Trinidad and Tobago"
	},
	{
		"code": "TN",
		"country": "TUN",
		"value": 0,
		"name": "Tunisia"
	},
	{
		"code": "TR",
		"country": "TUR",
		"value": 0,
		"name": "Turkey"
	},
	{
		"code": "TM",
		"country": "",
		"value": 0,
		"name": "Turkmenistan"
	},
	{
		"code": "TC",
		"country": "",
		"value": 0,
		"name": "Turks and Caicos Islands"
	},
	{
		"code": "TV",
		"country": "",
		"value": 0,
		"name": "Tuvalu"
	},
	{
		"code": "UG",
		"country": "UGA",
		"value": 0,
		"name": "Uganda"
	},
	{
		"code": "UA",
		"country": "UKR",
		"value": 0,
		"name": "Ukraine"
	},
	{
		"code": "AE",
		"country": "ARE",
		"value": 0,
		"name": "United Arab Emirates"
	},
	{
		"code": "GB",
		"country": "GBR",
		"value": 0,
		"name": "United Kingdom"
	},
	{
		"code": "US",
		"country": "USA",
		"value": 0,
		"name": "United States"
	},
	{
		"code": "UY",
		"country": "URY",
		"value": 0,
		"name": "Uruguay"
	},
	{
		"code": "UZ",
		"country": "UZB",
		"value": 0,
		"name": "Uzbekistan"
	},
	{
		"code": "VU",
		"country": "",
		"value": 0,
		"name": "Vanuatu"
	},
	{
		"code": "VE",
		"country": "VEN",
		"value": 0,
		"name": "Venezuela, RB"
	},
	{
		"code": "VN",
		"country": "VNM",
		"value": 0,
		"name": "Vietnam"
	},
	{
		"code": "VI",
		"country": "",
		"value": 0,
		"name": "Virgin Islands (U.S.)"
	},
	{
		"code": "PS",
		"country": "PSE",
		"value": 0,
		"name": "West Bank and Gaza"
	},
	{
		"code": "EH",
		"country": "",
		"value": 0,
		"name": "Western Sahara"
	},
	{
		"code": "YE",
		"country": "",
		"value": 0,
		"name": "Yemen, Rep."
	},
	{
		"code": "ZM",
		"country": "ZMB",
		"value": 0,
		"name": "Zambia"
	},
	{
		"code": "ZW",
		"country": "ZWE",
		"value": 0,
		"name": "Zimbabwe"
	}]
};
var year_json = [];
var country_json = [];

// render the map
function renderMap(year, cate){
    //get data
    get_year_data(year, cate);

    var mapText = 'Funding Number';
    var colorAxisMin = 1;
    var colorAxisMax = 1000;
    var dataName = 'Funding Number';
    var valueSuffix = '';
    if (cate == 'amount') {
        mapText = 'Funding Total Amount';
        colorAxisMin = 1000;
        colorAxisMax = 100000000000;
        dataName = 'Funding Total Amount';
        valueSuffix = ' ($)';
    }

    // Initiate the map
    Highcharts.mapChart('container', {

        title: {
            text: mapText
        },

        mapNavigation: {
            enabled: true,
            enableDoubleClickZoomTo: true
        },

        colorAxis: {
            min: colorAxisMin,
            max: colorAxisMax,
            type: 'logarithmic'
        },

        series: [{
            data: year_json,
            mapData: Highcharts.maps['custom/world'],
            joinBy: ['iso-a2', 'code'],
            name: dataName,
            states: {
                hover: {
                    color: '#a4edba'
                }
            },
            tooltip: {
                valueSuffix: valueSuffix
            },
            events: {
                click: function (e) {
                    showChart(this.chart.hoverPoints[0].country,this.chart.hoverPoints[0].name, cate);
                }
            }
        }]
    });
}

//get data by year for map
function get_year_data(year, cate) {
	$.ajax({
        url: "/api/get_dataset_by_year?y=" + year,
        type: "GET",
        dataType: "json",
        success: function (data) {
			var yearData = data.ret_list[0][cate];
			//console.log(yearData);
			load_year_json(yearData);
        },
        error: function (response, status, error) {
            console.log('Error: ' + error + ". Status: " + status);
        },
        async: false
	});
}

//load and format data for map
function load_year_json(yearData) {
	year_json = [];
	for (var i=0; i < yearData.length; i++){
		var country = yearData[i][0];
		var value = yearData[i][1];
		for (var j=0; j < init_year_json.country.length; j++) {
			if (country == init_year_json.country[j].country) {
				year_json[i] = {
					"code": init_year_json.country[j].code,
					"country": country,
					"value": value,
					"name": init_year_json.country[j].name
				};
			}
		}
	}
}

//show and render the chart
function showChart(country, name, cate){
	get_country_data(country, cate);
	var chart = AmCharts.makeChart("chartdiv", {
		"type": "serial",
		"theme": "light",
		"marginRight": 50,
		"marginLeft": 50,
		"autoMarginOffset": 20,
		"mouseWheelZoomEnabled":true,
		"dataDateFormat": "YYYY-MM-DD",
		"valueAxes": [{
			"id": "v1",
			"axisAlpha": 0,
			"position": "left",
			"ignoreAxisWidth":true
		}],
		"balloon": {
			"borderThickness": 1,
			"shadowAlpha": 0
		},
		"graphs": [{
			"id": "g1",
			"balloon":{
			  "drop":true,
			  "adjustBorderColor":false,
			  "color":"#ffffff"
			},
			"bullet": "round",
			"bulletBorderAlpha": 1,
			"bulletColor": "#FFFFFF",
			"bulletSize": 5,
			"hideBulletsCount": 50,
			"lineThickness": 2,
			"title": "red line",
			"useLineColorForBulletBorder": true,
			"valueField": "value",
			"balloonText": "<span style='font-size:12px;'>[[value]]</span>"
		}],
		"chartScrollbar": {
			"graph": "g1",
			"oppositeAxis":false,
			"offset":30,
			"scrollbarHeight": 80,
			"backgroundAlpha": 0,
			"selectedBackgroundAlpha": 0.1,
			"selectedBackgroundColor": "#888888",
			"graphFillAlpha": 0,
			"graphLineAlpha": 0.5,
			"selectedGraphFillAlpha": 0,
			"selectedGraphLineAlpha": 1,
			"autoGridCount":true,
			"color":"#AAAAAA"
		},
		"chartCursor": {
			"pan": true,
			"valueLineEnabled": true,
			"valueLineBalloonEnabled": true,
			"cursorAlpha":1,
			"cursorColor":"#258cbb",
			"limitToGraph":"g1",
			"valueLineAlpha":0.2,
			"valueZoomable":true
		},
		"valueScrollbar":{
		  "oppositeAxis":false,
		  "offset":50,
		  "scrollbarHeight":10
		},
		"categoryField": "date",
		"categoryAxis": {
			"parseDates": true,
			"dashLength": 1,
			"minorGridEnabled": true
		},
		"export": {
			"enabled": true
		},
		"dataProvider": country_json
	});

	chart.addListener("rendered", zoomChart);

	//zoomChart();

	function zoomChart() {
		chart.zoomToIndexes(chart.dataProvider.length - 40, chart.dataProvider.length - 1);
	}

	titleCountry.innerHTML = name;
	var titleCateText = (cate == 'num') ? 'Number' : 'Amount';
	titleCate.innerHTML = titleCateText;
	chartPopup.style.display = 'block';
}

//get data by country for chart
function get_country_data(country, cate) {
	$.ajax({
        url: "/api/get_dataset_by_country?c=" + country,
        type: "GET",
        dataType: "json",
        success: function (data) {
			var countryData = data.ret_list[0][cate];
			load_country_json(countryData);
        },
        error: function (response, status, error) {
            console.log('Error: ' + error + ". Status: " + status);
        },
        async: false
	});
}

//load and format data for chart
function load_country_json(countryData) {
	country_json = [];
	for (var i=0; i < countryData.length; i++){
		var date = countryData[i][0];
		var value = countryData[i][1];
		country_json[i] = {
			"date": date,
			"value": value
		};
	}
	country_json.sort(function(a,b){
		return Date.parse(a.date) - Date.parse(b.date);//时间正序
	});
}